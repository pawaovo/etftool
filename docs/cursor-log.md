# 网格策略页面开发日志

## 阶段一：基础结构与样式

### 2023-05-20

- ✅ **1.1: 创建 HTML 文件**: 创建了 `grid.html` 和 `grid-detail.html`，设置了基本骨架。
  - 创建了 `grid.html`，包含顶部导航按钮区、总体信息概览区、运行中和已暂停的网格策略卡片列表容器区
  - 创建了 `grid-detail.html`，包含返回按钮、顶部信息栏、图表容器、表格切换按钮、交易明细表格容器、网格策略表格容器（包含参数区和档位详情表区）

- ✅ **1.2: 引入 CSS**: 在两个HTML文件中链接了样式表。
  - 在 `grid.html` 中链接了 `plan-data.css` 和 `styles/etf-cards.css`
  - 在 `grid-detail.html` 中链接了 `plan-data.css` 和 `styles/etf-cards.css` 

- ✅ **1.3: 创建 JS 文件**: 创建了JS文件并在HTML文件中引入。
  - 创建了 `js/grid-data.js`，包含数据加载、计算和渲染的框架代码
  - 创建了 `js/grid-detail.js`，包含详情页的数据处理、图表和表格渲染的框架代码
  - 在相应HTML文件底部引入了这些JS文件

- ✅ **1.4: `grid.html` 布局**: 完善了grid.html布局。
  - 添加了顶部导航按钮，包括"150定投计划"、"S计划"和"网格策略"三个导航按钮
  - 增加了总体信息概览区，显示执行次数、买入/卖出金额、买入/卖出/剩余股数、收益/收益率
  - 为运行中网格策略区域添加了排序按钮：按执行次数、按累计收益率、按净值变化
  - 修复了CSS引入路径问题，确保样式正确应用

- ✅ **1.5: `grid-detail.html` 布局**: 完善了grid-detail.html布局。
  - 丰富了顶部信息栏，添加了ETF代码与名称、执行次数、累计收益率等多个信息项
  - 在交易明细表格添加了表尾合计行
  - 完善了网格策略参数区，添加了所有必要的参数项
  - 在网格档位详情表添加了表尾合计行
  - 修复了CSS引入路径问题，确保样式正确应用

## 阶段二：数据加载与核心计算

### 2023-05-21

- ✅ **2.1: 获取 JSON 文件列表**: 实现了JSON文件名列表获取功能。
  - 采用硬编码方式定义了`public/data/grid/`目录下的ETF文件列表
  - 包含了所有需要处理的ETF JSON文件名，如'159920(恒生ETF).json'等

- ✅ **2.2: 异步加载单个 JSON**: 实现了单个JSON文件的异步加载。
  - 使用`fetch` API加载指定路径的JSON文件
  - 添加了错误处理和异常捕获，确保接口健壮性
  - 即使加载失败也会返回空对象，不影响整体流程

- ✅ **2.3: 获取最新净值**: 实现了获取ETF最新净值的功能。
  - 优先尝试从本地缓存文件`latest_netvalues.json`加载
  - 如缓存不存在或加载失败，则从API获取最新数据
  - 解析ETF代码并通过API接口获取最新净值
  - 将结果处理成统一的`{code: netValue}`格式
  - 创建了示例净值缓存文件，用于本地测试

- ✅ **2.4: 加载所有数据**: 实现了并行加载所有ETF数据的功能。
  - 使用Promise.all并行加载所有ETF JSON文件，提高加载效率
  - 添加了详细的日志输出，方便调试和跟踪
  - 实现了加载状态显示和错误处理

- ✅ **2.5: 实现核心计算函数**: 实现了ETF数据计算逻辑。
  - 从源数据中提取ETF名称、代码和类别
  - 判断网格策略运行状态
  - 计算基准价（第一个档位平均买入价）
  - 将交易记录进行买卖配对
  - 计算累计收益和累计收益率
  - 计算小网步长并格式化步长显示
  - 确定当前档位和买入价
  - 计算净值变化率并确定卡片颜色

- ✅ **2.6: 处理所有ETF数据**: 实现了遍历处理所有ETF数据的功能。
  - 遍历所有加载的JSON数据
  - 提取ETF代码并获取对应的最新净值
  - 调用calculateEtfData处理每个ETF的数据
  - 生成包含所有ETF计算后数据的数组

- ✅ **2.7: 计算总体概览信息**: 实现了总体统计数据的计算。
  - 统计所有ETF的执行次数、买入金额、卖出金额
  - 计算总买入股数、总卖出股数、总剩余股数
  - 计算总收益和整体收益率 
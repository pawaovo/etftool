# 产品需求文档（PRD）——网格策略

## 1. 功能概述

目标：提供网格策略的整体展示，用户可以通过点击ETF网格策略卡片查看详细信息。弹窗展示该策略的交易历史、收益、净值趋势图等内容，帮助用户分析网格策略的表现。

## 2. 主界面展示 (`grid.html`)

主页面分为两块：顶部的页面跳转按钮和下方的网格策略信息展示（其中包括网格策略总体信息展示、网格策略卡片展示；网格策略卡片展示中又可点击进入对应网格策略详细信息展示`grid-detail.html`页面）

*开发者注：`grid.html` 页面的前端实现位于 `reference-html/index.html`。样式和 UI 与项目其他页面保持一致。*

### 2.1 页面跳转按钮

页面跳转按钮位于页面顶部，以按钮导航栏的形式进行展示

- **页面跳转按钮**：点击按钮可跳转至其他页面，例如：`150plan.html`和`Splan.html`。
- **按钮样式**：按钮样式参考`150plan.html`页面，样式UI一致。

### 2.2 网格策略信息展示

网格策略信息展示分为两块：顶部为网格策略总体信息展示，其下部分为网格策略卡片展示。

#### 2.2.1 网格策略总体信息展示

展示的信息共分为四项：执行次数、买入/卖出金额、买入/卖出/剩余股数、收益/收益率。（以上信息均来自于`public\data\grid`中的源数据，具体处理规则见文件`docs\grid\erd.md`）
以导航栏的形式在其顶部进行展示。

- **执行次数**：显示所有网格策略的执行次数之和，例如："102次"。
- **买入/卖出金额**：显示所有网格策略的买入/卖出金额之和，例如："12309/14509"。
- **买入/卖出/剩余股数**：显示所有网格策略的买入/卖出/剩余股数之和，例如："23465/22465/2265"。
- **收益/收益率**：显示所有网格策略的累计收益/累计收益率之和，例如："1020/40.1%"。

#### 2.2.2 网格策略卡片展示

网格策略分为两类：运行中（正在运行网格策略的基金）和已暂停（已暂停网格策略的基金）。
网格策略卡片展示中，按运行中和已暂停进行分类展示。各状态下展示对应的卡片信息。
每类卡片（运行中和已暂停）在展示中卡片的前后排列顺序支持按执行次数、累计收益率、净值对比买入价变化进行排序展示。默认按净值对比买入价变化进行排序展示。
每张卡片头部即"ETF代码和名称"区域会进行颜色区分，分为绿/红两色，规则为：
- 绿色：净值对比买入价变化为正，即最新净值高于买入价。
- 红色：净值对比买入价变化为负，即最新净值低于买入价。

每张卡片展示的信息共分为7项：ETF代码和名称、执行次数、累计收益率、当前档位/买入价、步长、最新净值、净值对比买入价变化。（以上信息均来自于`public\data\grid`中的源数据，具体处理规则见文件`docs\grid\erd.md`）

- **ETF代码和名称**：显示ETF的代码和名称，例如："159920(恒生ETF)"。
- **执行次数**：显示网格策略的执行次数，例如："20次"。
- **累计收益率**：显示网格策略的累计收益率，例如："+20.76%"。
- **当前档位/买入价**：显示网格策略的当前档位/买入价，例如："0.90（小网）/0.927"。当存在多个网格种类（小/中/大网）时，依次进行展示。
- **步长**：显示网格策略的步长，例如："5/15/30"。分别代表小/中/大网每格网的触发百分比。
- **最新净值**：显示网格策略的最新净值，例如："1.1557"。
- **净值对比买入价变化**：显示网格策略的净值对比买入价变化，例如："+2.11%。

可点击网格策略卡片下方的"查看详情"按钮，进入到对应的网格策略详细信息展示页面进行查看。

### 2.2 主界面交互

- **卡片排序**：支持按执行次数、累计收益率、净值对比买入价变化等方式对网格策略卡片进行排序。默认按净值对比买入价变化进行排序展示。
- **查看详情**：支持点击网格策略卡片下方的"查看详情"按钮，进入到对应的网格策略详细信息展示页面进行查看。
- **响应式设计**：主界面适配不同屏幕尺寸。

## 3. 网格策略详细信息展示： (`grid-detail.html`)

共分为3块：顶部的顶部信息栏、上半部分的趋势图、下半部分的交易明细表格和网格策略表格（两种表格通过表格切换按钮进行切换展示，默认展示交易明细表格）。
点击左上角的"返回"按钮，返回到`grid.html`页面。

*开发者注：`grid-detail.html` 页面的前端实现位于 `reference1-html/grid-trading-calculator.html`。样式和 UI 与项目其他页面保持一致。*

### 3.1 顶部信息栏

在其顶部以一行导航栏信息的文字进行展示。展示内容如下：

- **ETF代码与名称**：同卡片。
- **执行次数**：同卡片。
- **累计收益率**：同卡片。
- **当前档位/买入价**：同卡片。
- **步长**：同卡片。
- **最新净值**：同卡片。
- **净值对比买入价变化**：同卡片。

### 3.2 上半部分：趋势图（主视觉区域）

- **数据来源**：数据来自于`public\data\grid`中的源数据，具体处理规则见文件`docs\grid\erd.md`）
- **横坐标**：时间轴（基于`日期`），用户可以拖动或缩放。
- **纵坐标**：ETF基金的净值价格（基于 `实际交易价格`）。
- **买卖点标注**：
  - 在图上对应时间和价格位置标注买入点 (B) 和卖出点 (S)。买入/卖出点信息由交易记录所得。
  - **需要数据**：`交易记录` 中的 `日期`、`实际交易价格`、`交易金额`（判断买卖）。
- **标注线**：在图上绘制一条红色的水平线表示本网格策略的当前档位和买入价。
- **趋势图交互**：鼠标悬停在某一买/卖点上时，将其对应的买/卖点进行连线显示，展示本次交易的详细数据，包括执行档位、买入/卖出时间、价格、金额、股数、收益、收益率。

### 3.3 下半部分：交易明细表格和网格策略表格

两种表格通过表格切换按钮进行切换展示，默认展示交易明细表格

#### 3.3.1 交易明细表格

- **数据来源**：数据来自于`public\data\grid`中的源数据，经处理后得到交易记录数据。具体处理规则见文件`docs\grid\erd.md`）
- **序号**：交易记录编号。
- **交易日期**：显示本次交易的日期。
- **交易金额**：显示本次交易的金额。
- **交易价格**：显示本次交易的实际交易价格。
- **交易股数**：显示本次交易的股数。
- **收益**：显示本次交易的收益。
- **收益率**：显示本次交易的收益率。
- **累计收益/累计收益率**：可以考虑在表格末尾显示所有已完成交易的累计收益/累计收益率。

#### 3.3.2 网格策略表格

该部分应设计为可在前端页面上进行参数修改，实时生成新的网格策略表格进行查看。
**(注意：参数修改、实时生成和保存功能目前正在开发中)**

分为两部分：上半部分的网格策略参数和下半部分的网格策略表格。

网格策略参数包括：标的类型、最小报价单位、最小交易单位、基准价、每份金额、最低价、小网步长、中网步长、大网步长、档位加码系数、金额加码系数、保留利润系数。该部分默认根据拿到的源数据处理后进行展示。
**计划实现**: 支持通过"修改"按钮，修改各参数，在下方的网格策略表格中生成对应的表格信息，并提供"保存"按钮将修改后的参数写回源文件。

网格策略表格：通过源数据得到的交易数据，推算出网格策略各档位的信息。包括网格种类、档位、买入触发价、买入价、买入金额、买入股数、卖出触发价、卖出价、卖出股数、卖出金额、剩余股数、收益、收益率。以及表格最小方的网格策略累计买入金额、累计买入股数、累计卖出金额、累计卖出股数、累计剩余股数、累计收益、累计收益率。

- **数据来源**：所有数据来自于`public\data\grid`中的源数据，经处理后得到交易记录数据。具体处理规则见文件`docs\grid\erd.md`）

## 4. 功能需求

### 4.1 数据展示

- **数据来源**：`grid.html`和`grid-detail.html`页面所有数据均来源于 `public/data/grid/` 目录下的对应ETF的JSON文件。经处理转换后使用。
- **数据处理**：需要对源JSON数据进行处理和转换，计算出页面所需的所有字段和数据信息。**重要**：所有计算逻辑（如状态、收益率、价格区间、交易次数、关联买卖记录等）需在JS中实现。具体转换细节参考 `erd.md`。
- **数据刷新**：页面加载时读取所有JSON数据。**暂定不实现自动刷新**，用户需要手动刷新浏览器页面以查看更新后的数据。后续可考虑添加刷新按钮。
- **趋势图与交易表格**：图表库（待选型，例如Chart.js, ECharts）和表格所需的数据格式应由JS准备好。

### 4.2 页面交互

- **弹窗打开与关闭**：点击卡片的"[查看详情]"按钮打开对应ETF的详细页面。页面内左上角应有明确的返回按钮。
- **趋势图交互**：用户可在趋势图上悬停查看买卖点信息，支持缩放和拖动。
- **网格策略表格交互**：用户可修改原始表格参数，生成新的网格策略表格进行查看。
**(注意：此交互功能正在开发中，包括参数修改、实时计算、生成和保存)**

### 4.3 动效设计 (可选，优先级较低)

- **卡片与弹窗过渡**：平滑的打开/关闭动画。
- **图表加载/交互动画**：图表库自带的动画效果。

### 4.4 注意事项

- **UI一致性**：页面 (`grid.html` 的实现位于 `reference-html/index.html`，`grid-detail.html` 的实现位于 `reference1-html/grid-trading-calculator.html`) 的整体风格（颜色、字体、布局、卡片样式、交互反馈等）应与项目其他页面保持视觉统一。复用通用样式（如 `plan-data.css`, `styles/etf-cards.css`），并确保新页面的 UI 样式规范、功能和显示正常。

## 5. 非功能性需求
- **性能**: 页面加载速度应尽可能快，尤其是在处理多个JSON文件和渲染图表时。
- **可维护性**: JavaScript代码应模块化，有清晰的注释，便于理解和修改。
- **错误处理**: 对出现问题的地方应该打上节点，通过控制台返回的错误信息进行查看和处理。

---
*（文档结束）* 
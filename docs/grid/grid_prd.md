# 基于E大网格策略的智能表格系统需求文档

## 核心功能需求

### 1. 网格策略参数配置模块
需支持以下核心参数的动态配置（参考）：

**标的类型及参数**：
每类标的有其对应的默认最小报价单位、最小交易单位、基准价（第一份买入价）
每类标的可通过输入框自定义更改各自的默认值

- 标的类型（中国场内基金/中国股票/国外股票）
- 中国场内基金默认最小报价单位0.001，最小交易单位100，基准价1.000
- 中国股票默认最小报价单位0.01，最小交易单位100，基准价1.00
- 国外股票默认最小报价单位0.01，最小交易单位1，基准价1.00

**网格基础参数**：
- 每份金额（第一份即每一个档位下的买入金额，不同档位的买入金额会乘一个系数即金额加码系数），默认为10000，可用输入框自定义进行修改
- 最低价（低于此价不会再买入，默认设置这个值为基准价的10%，当价格跌破这个值时，会暂停买入），默认为基准价的一半，可用输入框自定义进行修改
- 小/中/大网步长（步长即跌多少个百分点后触发下一个档位），分别默认为5%/15%/30%，可用输入框自定义进行修改
- 档位加码系数及初始加码档位，默认为1.0（额外利润1%）和第3档（小网3档），可用输入框自定义进行修改
- 金额加码系数（逐级增加买入金额。如: 0:按照设定好的每份金额买入。公式：每份金额 + 每份金额 * 系数 * (1 - 当前档位)。比如：每份金额是10000，系数是1，当前档位是0.9，则买入金额是10000 + 10000 * 1 * (1 - 0.9) = 11000），默认为1.0，可用输入框自定义进行修改
- 保留利润系数（卖出时，是否保留利润。如: 0:不保留利润，0.5:保留一半利润，1:保留全部利润，2:保留两倍利润），默认为1.0，可用输入框自定义进行修改

### 2. 智能网格生成引擎
根据网格设定的参数自动生成包含以下字段的网格表格（需遵循设计逻辑）：

|网格种类| 档位 | 买入触发价 | 买入价 | 买入金额 | 买入股数 | 卖出触发价 | 卖出价 | 卖出股数 | 卖出金额 |
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|------|------|------------|--------|----------|--------|------------|--------|--------|----------|
|合计--|------|------------|--------|----------|--------|------------|--------|--------|----------|

|压力测算与盈利测算--------------------------------------------------------------------------------|
|买入金额-----------|买入股数-----------|卖出金额-----------|卖出股数-------------------------------|
|剩余股数-----------|总利润-----------|总利润率----------------------------------------------------|

**生成规则**：
基本所有计算都基于档位和步长（十分重要）

- 步长 = 默认小/中/大网为5%/15%/30%(可自定义修改)

- 档位：要通过小网步长+初始档位+档位加码系数综合进行计算，规则如下。
第一步：
如小网步长按默认5%进行计算，小/中/大网各初始档位：
小网档位依次为：1档：1.00，2档：0.95，3档：0.90，4档：0.85，5档：0.80，6档：0.75，7档：0.70，8档：0.65，9档：0.60，10档：0.55...
中网档位依次为：1档：0.85，2档：0.70，3档：0.55，4档：0.40，5档：0.25，6档：0.10...
大网档位依次为：1档：0.70，2档：0.40，3档：0.1...
（默认最低价跌破基准价10%时，不再买入，即不再设置更低的档位，即初始档位最低档为0.10）
第二步：
根据初始档位和档位加码系数及初始加码档位进行计算，这里的档位加码系数指每个档位之间额外增加的利润（在原有默认5%的基础上增加的值），初始加码档位值从哪个档位开始引入档位加码系数进行档位计算。
如默认档位加码系数为1.0，初始加码档位为4，即从小网4档即0.85开始以额外增加的档位加码系数0.01（即1%的利润）进行计算：

小网第4档从未加入档位加码系数及初始加码档位之前的0.85（第3档0.90-0.05）变为0.84（第三档0.90-0.05-0.01），因为加入了档位加码系数1.0（代表意思为1%的利润，计算时即0.01）和初始加码档位4，所以从这档开始的第4档开始，每一档位的实际档位都要在前一档位从前前档位减少的值的基础上再-0.01，以此类推。
当这里的默认档位加码系数为1.0，初始加码档位为4，即小网4档即0.85；初始加码系数为0.10时：
小网档位依次为：1档：1.00，2档：0.95，3档：0.90，4档（开始变化）：0.84（0.90-0.05-0.01），5档：0.77（0.84-0.05-0.01-0.01），6档：0.69（0.77-0.05-0.01-0.01-0.01），7档：0.60（0.69-0.05-0.01-0.01-0.01-0.01）...

中网档位的实际加码系数为小网加码系数的2倍，且忽视设置的初始加码档位，直接从中网第2档位开始变化（只要设置了档位加码系数，不论设置的初始加码档位是几，都直接从中网第2档开始变化）这里即1.0x2=2.0，所以中网档位依次为：1档：0.85，2档（开始变化）：0.68（0.85-0.15-0.01x2），3档：0.49（0.68-0.15-0.01x2-0.01x2），4档：0.28（0.49-0.15-0.01x2-0.01x2-0.01x2）...

大网档位的实际加码系数为小网加码系数的3倍，且忽视设置的初始加码档位，直接从大网第2档位开始变化（只要设置了档位加码系数，不论设置的初始加码档位是几，都直接从大网第2档开始变化）这里即1.0x3=3.0，所以大网档位依次为：1档：0.70，2档（开始变化）：0.37（0.70-0.30-0.01x3）...

- 某档位下的买入价 = 基准价 x 其档位值
- 某档位下的买入触发价 = 其买入价 + 0.005
- 某档位下的卖出价 = 其上一档位的买入价
- 某档位下的卖出触发价 = 其卖出价 - 0.005
- 某档位下的买入金额 = 网格基础参数中设定好的每份金额值 + 其每份金额值 * 金额加码系数 * (1 - 其当前档位)。比如：每份金额是10000，系数是1，当前档位是0.9，则买入金额是10000 + 10000 * 1 * (1 - 0.9) = 10100
- 某档位下的买入股数 = 其某档位下的买入金额/其档位下的买入价。（受其最小交易单位影响）
特别注意：买入金额和买入股数会受其标的的最小交易单位发生变化。如：计算得出某档位下的买入金额为10100，其档位下的买入价为0.900，其最小交易单位为100，则买入股数计算值=10100/0.900=11222.222，其买入股数实际值为11200（最小交易单位为100，舍去了计算值不足100的22.222）。则买入金额计算值=10100，买入金额实际值=买入股数实际值 x 买入价=11200 x 0.900 =10080
在网格策略表格中各档位的买入金额和买入股数都是其实际值而不是计算值

- 某档位下的卖出金额和某档位下的卖出股数规则为：
某档位下的卖出金额 = 其档位的卖出价 x 其卖出股数（受保留利润系数影响）。
如保留利润系数为0.5（默认为1.0。定义为：卖出时，是否保留利润。如: 0:不保留利润，0.5:保留一半利润，1:保留全部利润，2:保留两倍利润） ，则卖出时保留价值一半利润的股数不卖出。比如：买入价0.950，买入金额10450，买入股数	11000，此时本次利润=（卖出价-买入价）x 买入股数=（1.000-0.950）x 	11000 =550，此时由于保留利润系数为0.5即保留价值一半利润的股数不进行卖出，即保留价值为550/2=225的股数不卖出，即保留的股数=225/1.000=225股，由于交易的股数受其最小交易单位（默认为100股）影响。
所以实际保留股数为200股，实际卖出股数为11000-200=10800，实际卖出金额为实际卖出股数 x 卖出价 =10800 x 1.00 =10800

### 3. 压力测试与盈利测算
展示信息为买入总金额、买入总股数、卖出总金额、卖出总股数、剩余股数、总利润、总利润率



## 非功能性需求

### 响应式交互设计
- 支持用户修改参数进行操作
- 实时预览功能：参数修改后200ms内更新表格


## 辅助功能需求（目前无对应前端页面内容，可先不考虑实现）

### 1. 策略对比模块
允许同时对比多个网络策略表格信息

### 2. 可视化分析
集成ECharts实现以下视图：
- 网格压力测试热力图（X轴价格/Y轴仓位）
- 资金使用效率甘特图

### 3. 帮助系统
内置策略解释器（引用原理）：


## 交付标准
1. 可独立部署的Web组件（Vue3/React框架）
2. 支持导出CSV/XLSX格式网格表格（可先不考虑实现）
4. 压力测试模块误差率＜0.5%（蒙特卡洛模拟验证）

---
